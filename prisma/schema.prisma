// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Post {
    id        Int      @id @default(autoincrement())
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index([name])
}

model User{
    id          String @id @default(uuid())
    email       String @unique
    name        String
    password    String
    userType    String
    imageUrl    String
    phoneNumber String
    class       Class[]
    centres     Centre[]
}
model Demo{
    id String @id
}

model Student{
    studentId       String @id @default(uuid())
    name            String
    address         String
    parentName      String
    parentOccupation String
    parentContactNumber1   String
    parentContactNumber2 String?
    idProof         String
    idProofType         String
    centreId        String
    courseDuration  String
    classDays String[]
    classTiming String
    courseName String
    imageUrl    String
    readdmission    Boolean
    centre          Centre @relation(fields: [centreId], references: [id], onDelete: Cascade)
    studentMappings StudentClass[]
    attendance      Attendance[]
    payments        Payment[]
    createdAt DateTime @default(now()) @db.Timestamptz(5)
    updatedAt          DateTime  @updatedAt @db.Timestamptz(5)
}
model StudentClass {
    studentId String
    classId   String
    student   Student @relation(fields: [studentId], references: [studentId], onDelete: Cascade)
    class     Class   @relation(fields: [classId], references: [id], onDelete: Cascade)
    @@id([studentId, classId]) // Composite primary key
}
model Class{
    id              String @id @default(uuid()) // Add an explicit ID
    subject         String
    centreId        String
    facultyId       String
    facultyName     String
    faculty         User @relation(fields: [facultyId], references: [id])
    centre          Centre @relation(fields: [centreId], references: [id], onDelete: Cascade)
    studentMappings StudentClass[]
    attendance      Attendance[]
}
model Centre {
    id          String @id @default(uuid())  // Unique identifier for the centre
    name        String @unique// Name of the institute
    location    String // Address or location details
    payments    Payment[]
    students    Student[]
    classes     Class[]
    attendance  Attendance[]
    faculties   User[]
}

model Attendance {
    id        String   @id @default(uuid()) // Unique identifier
    studentId String
    classId   String
    centreId  String
    date      DateTime // Date of the class
    status    AttendanceStatus // Enum for attendance status
    student   Student  @relation(fields: [studentId], references: [studentId], onDelete: Cascade)
    class     Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
    centre    Centre   @relation(fields: [centreId], references: [id], onDelete: Cascade)
    @@unique([studentId, classId, date]) // A student can only have one attendance record per class per date
}
model Payment {
    id          String   @id @default(uuid()) 
    studentId   String
    centreId    String
    amountPaid  Float    // Amount paid by the student
    paymentDate DateTime // Date of payment
    status      PaymentStatus // Enum: Paid, Pending, Partial
    student     Student  @relation(fields: [studentId], references: [studentId], onDelete: Cascade)
    centre      Centre   @relation(fields: [centreId], references: [id], onDelete: Cascade)
    @@unique([studentId, paymentDate]) // A student can only have one payment record per date
}
enum AttendanceStatus {
    PRESENT
    ABSENT
    LATE
    EXCUSED
}
enum PaymentStatus {
    PAID
    PENDING
    PARTIAL
}